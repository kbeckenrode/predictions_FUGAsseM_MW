<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1671.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">---</p>
<p class="p1">title: "Predictions"</p>
<p class="p1">output:</p>
<p class="p1"><span class="Apple-converted-space">  </span>html_document: default</p>
<p class="p1"><span class="Apple-converted-space">  </span>pdf_document: default</p>
<p class="p1">date: "2022-10-19"</p>
<p class="p1">---</p>
<p class="p2"><br></p>
<p class="p1">```{r setup, include=FALSE}</p>
<p class="p1">knitr::opts_chunk$set(echo = TRUE)</p>
<p class="p1">```</p>
<p class="p2"><br></p>
<p class="p1">##Look for other enzymes like this (i.e. mucus utilization) in Bacteroides/Parabacteroides</p>
<p class="p1">##Snip off top MetaWIBELE prioritizations in Bacteroides (etc.)</p>
<p class="p1">##Look for overlap of these with FUGAsseM predictions in glycan utilization terms</p>
<p class="p1">##Probably starting with GO:0006486 or GO:0009100, or wherever that overlaps with the FUGAsseM prediction “slice” set</p>
<p class="p2"><br></p>
<p class="p1">## Step 1: Import FUGAsseM prediction file, METAWIBELE file, and list of FUGAsseM taxa into R project.</p>
<p class="p1">```{r}</p>
<p class="p1">library(readr)</p>
<p class="p1">HMP2_fugassem_GO_func_assignment_tsv &lt;- read_delim("HMP2_fugassem_GO.func_assignment.tsv.gz",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>delim = "\t", escape_double = FALSE,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>trim_ws = TRUE)</p>
<p class="p1">##View(HMP2_fugassem_GO_func_assignment_tsv)</p>
<p class="p2"><br></p>
<p class="p1">library(readr)</p>
<p class="p1">HMP2_fugassem_string_taxa &lt;- read_table("HMP2_fugassem_string_taxa.txt")</p>
<p class="p1">##View(HMP2_fugassem_string_taxa)</p>
<p class="p2"><br></p>
<p class="p1">##load MetaWIBELE files</p>
<p class="p1">library(readr)</p>
<p class="p1">only_bacteroidetes &lt;- read_delim("only_bacteroidetes.tsv",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>delim = "\t", escape_double = FALSE,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>trim_ws = TRUE)</p>
<p class="p1">View(only_bacteroidetes)</p>
<p class="p2"><br></p>
<p class="p1">library(readr)</p>
<p class="p1">only_proteobacteria &lt;- read_delim("only_proteobacteria.tsv",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>delim = "\t", escape_double = FALSE,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>trim_ws = TRUE)</p>
<p class="p1">View(only_proteobacteria)</p>
<p class="p2"><br></p>
<p class="p1">library(readr)</p>
<p class="p1">only_firmicutes &lt;- read_delim("only_firmicutes.tsv",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>delim = "\t", escape_double = FALSE,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>trim_ws = TRUE)</p>
<p class="p1">View(only_firmicutes)</p>
<p class="p2"><br></p>
<p class="p1">##load FUGAsseM</p>
<p class="p1">library(readr)</p>
<p class="p1">HMP2_fugassem_GO_func_assignment &lt;- read_delim("HMP2_fugassem_GO.func_assignment.tsv",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>delim = "\t", escape_double = FALSE,<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>trim_ws = TRUE)</p>
<p class="p1">View(HMP2_fugassem_GO_func_assignment)</p>
<p class="p2"><br></p>
<p class="p1">#Load FUGAsseM filtered for GO:0000242</p>
<p class="p1">library(readr)</p>
<p class="p1">log &lt;- read_delim("log.tsv", delim = "\t",<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">    </span>escape_double = FALSE, trim_ws = TRUE)</p>
<p class="p1">View(log)</p>
<p class="p2"><br></p>
<p class="p1">```</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">```{r}</p>
<p class="p1">## Step 2: Load libraries</p>
<p class="p2"><br></p>
<p class="p1">library(dplyr)</p>
<p class="p1">library(stringr)</p>
<p class="p2"><br></p>
<p class="p1">## adding<span class="Apple-converted-space">  </span>%&gt;% filter(`Priority score` &gt;0.5)<span class="Apple-converted-space">  </span>will pipe more filters as a TRUE/FALSE statement</p>
<p class="p2"><br></p>
<p class="p1">```</p>
<p class="p2"><br></p>
<p class="p1">```{r}</p>
<p class="p1">##Step 3: (only need to do once to make file) Get GO terms at and beneath parent terms 'GO:0000242". 'GO:0006486' or 'GO:0009100'</p>
<p class="p2"><br></p>
<p class="p1">library(GOfuncR)</p>
<p class="p1">##GO_biofilm&lt;-get_child_nodes(c('GO:0042710'))</p>
<p class="p1">GO_272&lt;-get_child_nodes(c('GO:0000272'))</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">```</p>
<p class="p1">```{r}</p>
<p class="p1">##Step4: filter MetaWIBELE by top 10%</p>
<p class="p2"><br></p>
<p class="p1">only_bacteroidetes_filtered &lt;- only_bacteroidetes %&gt;% filter(`Priority score` &gt;0.9)</p>
<p class="p1">only_proteobacteria_filtered &lt;- only_proteobacteria %&gt;% filter(`Priority score` &gt;0.9)</p>
<p class="p1">only_firmicutes_filtered &lt;- only_firmicutes %&gt;% filter(`Priority score` &gt;0.9)</p>
<p class="p1">```</p>
<p class="p2"><br></p>
<p class="p1">## Step 5: Find Bacteroides and filter in FUGAsseM file. Also, re-arrange syntax of func column by adding a new fixed column. There was extra information attached to the GO term, so it could not intersect as is.</p>
<p class="p2"><br></p>
<p class="p1">```{r}</p>
<p class="p2"><br></p>
<p class="p1">bb &lt;- HMP2_fugassem_GO_func_assignment_tsv %&gt;% filter(str_detect(taxa_lineage, "p__Bacteroidetes"))</p>
<p class="p1">new_b&lt;-data.frame(str_split_fixed(bb$func,"\\[",2 ))</p>
<p class="p1">new_b3&lt;-gsub(":","", new_b$X1)</p>
<p class="p1">new_b4&lt;-gsub("GO","GO:", new_b3)</p>
<p class="p1">bb$fixed&lt;-new_b4</p>
<p class="p2"><br></p>
<p class="p1">```</p>
<p class="p2"><br></p>
<p class="p1">```{r}</p>
<p class="p1">bb2 &lt;- log %&gt;% filter(str_detect(taxa_lineage, "p__Bacteroidetes"))</p>
<p class="p1">new_b&lt;-data.frame(str_split_fixed(bb$func,"\\[",2 ))</p>
<p class="p1">new_b3&lt;-gsub(":","", new_b$X1)</p>
<p class="p1">new_b4&lt;-gsub("GO","GO:", new_b3)</p>
<p class="p1">bb2$fixed&lt;-new_b4</p>
<p class="p1">```</p>
<p class="p2"><br></p>
<p class="p1">```{r}</p>
<p class="p1">bp &lt;- log %&gt;% filter(str_detect(taxa_lineage, "p__Proteobacteria"))</p>
<p class="p1">new_b&lt;-data.frame(str_split_fixed(bp$func,"\\[",2 ))</p>
<p class="p1">new_b3&lt;-gsub(":","", new_b$X1)</p>
<p class="p1">new_b4&lt;-gsub("GO","GO:", new_b3)</p>
<p class="p1">bp$fixed&lt;-new_b4</p>
<p class="p2"><br></p>
<p class="p1">```</p>
<p class="p2"><br></p>
<p class="p1">```{r}</p>
<p class="p1">bf &lt;- log %&gt;% filter(str_detect(taxa_lineage, "p__Firmicutes"))</p>
<p class="p1">new_b&lt;-data.frame(str_split_fixed(bf$func,"\\[",2 ))</p>
<p class="p1">new_b3&lt;-gsub(":","", new_b$X1)</p>
<p class="p1">new_b4&lt;-gsub("GO","GO:", new_b3)</p>
<p class="p1">bf$fixed&lt;-new_b4</p>
<p class="p2"><br></p>
<p class="p1">```</p>
<p class="p1">## Step 6: Intersect Bacteroides filtered MetaWIBELE priorities and FUGAsseM predictions with GO terms</p>
<p class="p2"><br></p>
<p class="p1">```{r}</p>
<p class="p1">##Intersect MetaWIBELE with GO list</p>
<p class="p1">both_MW_go_b &lt;-(data.frame(intersect(only_bacteroidetes_filtered$`GO(BP)`, GO_272$child_go_id)))</p>
<p class="p1">both_MW_go_p &lt;-(data.frame(intersect(only_proteobacteria_filtered$`GO(BP)`, GO_272$child_go_id)))</p>
<p class="p1">both_MW_go_f &lt;-(data.frame(intersect(only_firmicutes_filtered$`GO(BP)`, GO_272$child_go_id)))</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1">##Intersect FUGAsseM for GO terms</p>
<p class="p1">##both_FUGAsseM_go&lt;-(data.frame(intersect(b$fixed, GO_expanded$child_go_id)))</p>
<p class="p2"><br></p>
<p class="p1">both_FUGAsseM_go_b&lt;-(data.frame(intersect(bb2$fixed, GO_272$child_go_id)))</p>
<p class="p1">both_FUGAsseM_go_f&lt;-(data.frame(intersect(bf$fixed, GO_272$child_go_id)))</p>
<p class="p1">both_FUGAsseM_go_p&lt;-(data.frame(intersect(bp$fixed, GO_272$child_go_id)))</p>
<p class="p2"><br></p>
<p class="p1">FUGAsseM_go_b_intersect&lt;-(data.frame(intersect(bb2$feature, only_bacteroidetes_filtered$familyID)))</p>
<p class="p2"><br></p>
<p class="p1">#Filter FUGAsseM by 10%</p>
<p class="p1">both_FUGAsseM_go_b_filtered &lt;- bb2 %&gt;% filter(`score` &gt;0.90)</p>
<p class="p2"><br></p>
<p class="p1">##Intersect MetaWIBELE with FUGAsseM using UniRef90 column name (from training with Xochitl)</p>
<p class="p1">## both&lt;-intersect(HMP2_prioritized_list_Pfam$`UniRef90 ID`,HMP2_fugassem_GO_func_assignment_tsv$UniRef90)</p>
<p class="p2"><br></p>
<p class="p1">write_csv(both_FUGAsseM_go, "FUGAsseM_GO")</p>
<p class="p1">write.csv(both_go_BP, "test_BP.csv")</p>
<p class="p2"><br></p>
<p class="p1">```</p>
</body>
</html>
